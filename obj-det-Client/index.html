<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>object detector</title>
</head>

<body style="background-color:powderblue;">
	<style>
		.center {
			position: absolute;
			left: 50%;
			top: 50%;
			transform: translate(-50%, -50%);
			border: 5px solid #808080;
			padding: 10px;
		}
	</style>
	<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"> </script>
	<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"> </script>
	<script>
		let modelPromise;
		window.onload = () => {
			//loadModel();
		}

		async function loadModel() {
			console.log('start : ' + getFullTimestamp());
			modelPromise = await cocoSsd.load();
			console.log('end : ' + getFullTimestamp());
		}
		async function detectObjectinImage() {
			console.log('objectdetect invoked');
			console.log('start : ' + getFullTimestamp());
			const img = document.getElementById('output');
			let objects = '';
			modelPromise = await cocoSsd.load();
			const result = await modelPromise.detect(img);
			console.log('end : ' + getFullTimestamp());
			if (result.length < 1) {
				objects = objects + 'None'
			}
			else {
				for (let i = 0; i < result.length; i++) {
					objects = objects + result[i].class + ' ';
				}
			}
			console.log(objects);
			const detectedObject = document.getElementById('objects');
			detectedObject.innerHTML = ' ' + objects;
		}

		function getFullTimestamp() {
			const pad = (n, s = 2) => (`${new Array(s).fill(0)}${n}`).slice(-s);
			const d = new Date();

			return `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}.${pad(d.getMilliseconds(), 3)}`;
		}


		var loadFile = function (event) {
			const detectedObject = document.getElementById('objects');
			detectedObject.innerHTML = '';
			var image = document.getElementById('output');
			image.src = URL.createObjectURL(event.target.files[0]);
		}
	</script>
	<div class="center">
		<input type="file" id="photo" name="photo" onchange="loadFile(event)" accept="image/*">
		<p><img id="output" width="400" height="400"/></p>

		<p>
			<button onclick="detectObjectinImage()">Detect</button>
			<span id="objects"></span>
		</p>
	</div>
</body>

</html>